name: CodeControl
on:
 push:
jobs:
  packer:
    runs-on: ubuntu-20.04
    container:
      image: raphaeldegail/packer:1.8.0
    env:
      PKR_VAR_workspace: "{name=\"name\", project=\"project\", region=\"region\"}"
      PKR_VAR_machine: "{source_image_family=\"source\", rsa_keystore={private=\"private\", public=\"public\"}}"
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Read version
        run: |
          echo "PKR_VAR_version={\"number\":\"$(cat VERSION.txt)\",\"type\":\"develop\",\"commit\":\"$GITHUB_SHA\"}" >> $GITHUB_ENV
      - name: Check format of Packer script
        run: packer fmt -check .
      - name: Initialize packer with plugins
        run: packer init .
      - name: Validate Packer script
        run: packer validate .